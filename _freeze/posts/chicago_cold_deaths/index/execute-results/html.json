{
  "hash": "b83c27f5e1d238defee925ab73969fae",
  "result": {
    "markdown": "---\ntitle: \"PH425 Final Project\"\nauthor: \"Daniel P. Hall Riggins\"\ndate: today\nformat: html\nbibliography: references.bib\nexecute: \n    warning: false\ncode-overflow: wrap\ncategories: [cold, epidemiology, chicago]\n---\n\n\n# Introduction\n\nCook County Health and Housing Forward’s Recuperation in Supportive Environment (RISE) Center cares for people experiencing homelessness as they become well enough to discharge from a hospital, but still need a stable home environment in which to medically recover. \nRISE provides both basic medical services from 24-hr medical assistants and social services from case managers.\nIn winter months, RISE Center experiences a strong uptick in clients admitted due to frostbite and other cold-related injuries. \nOften these clients have newly amputated digits or limbs, which robs them of independence with their activities of daily living. \nThese injuries are consequences of societal policies that do not adequately prioritize protection and care for people experiencing homelessness.\n\nOne means of mitigating the threat of cold weather is to provide warming centers. \nThe City of Chicago designates facilities like libraries, community centers, senior centers, and police stations as available when temperatures dip lower than 32 degrees Fahrenheit “for all residents in need of safe refuge and relief from extreme cold weather.”\nThe objective of this analysis was to compare the locations of hypothermic deaths investigated by the Cook County Medical Examiner (CCME) to locations of warming centers. \nAre there geographic gaps where a significant number of deaths have taken place, but there are no warming facilities nearby?\n\n# Data Description\n\nI obtained data from multiple sources. \nThe outcome of interest was incidence of cold-related deaths, the location of which were obtained from the CCME Case Archive [@MedicalExaminerCasea].\n<!-- Cold-related deaths were spatially aggregated by intersection into case counts for census tracts of Cook County, which were obtained from the U.S. Census Bureau's TIGER Data Products accessed via the R package {tigris} [@TIGERDataProducts; @kylewalkerTigrisPackage]. -->\nLocations of warming centers were obtained from The City of Chicago [@levyWarmingCenters2017].\n<!-- Census tract populations and other social demographic covariates were obtained from the CDC's Social Vulnerability Index Data Product [@SocialVulnerabilityIndex]. -->\n\n# Methodology\n\nThe analysis was conducted with the R programming language [@ProgrammingLanguage].\nData was cleaned and joined using the {tidyverse} suite of packages for core data wrangling [@TidyversePackageSuite], the {sf} package for simple feature data [@edzerpebesmaSfPackage], and {terra} for raster data [@robertj.hijmansTerraSpatialData].\nKernel density estimation was performed using {spatstat} [@adrianbaddeleySpatstatSpatialPoint].\nData was mapped using {tmap} [@tennekesTmapThematicMaps].\n\nFurther steps are described in the analysis section.\n\n# Analysis\n\nFirst, load the needed packages in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # Data Manipulation\nlibrary(sf) # Simple features manipulation\nlibrary(terra) # Raster manipulation\nlibrary(tidyterra) # Helper functions for terra\nlibrary(spatstat) # Point patter analysis\nlibrary(tmap) # Mapping\n```\n:::\n\n\nNext, read in the needed data and clean it:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_2a4aba3e1b78df581c7be776b6e2c5a8'}\n\n```{.r .cell-code}\nchicago_border <-\n    # Parse from geojson file\n    st_read(here::here(\"data\", \"chicago_border.geojson\")) |> \n    # Transform to \"NAD83/Illinois East\" projection\n    st_transform(26971) \n\nchicago_comm_areas <- \n    # Parse from geojson file\n    st_read(here::here(\"data\", \"chicago_community_areas.kml\")) |> \n    # Transform to \"NAD83/Illinois East\" projection\n    st_transform(26971) |> \n    # Change to title case for text in the \"community\" variable\n    mutate(\n        community = str_to_title(community)\n    ) |> \n    # Drop all variables but \"community\"\n    select(community)\n\ncold_deaths <-\n    # Parse geojson file\n    st_read(here::here(\"data\", \"Medical_Examiner_Case_Archive,_2014_to_present.geojson\")) |> \n    # Filter for cold-related deaths\n    filter(COLD_RELATED == \"YES\") |> \n    # Filter for geotagged cases\n    filter(!is.na(latitude) & !is.na(longitude)) |> \n    # Filter for cases taking place in Chicago proper\n    filter(INCIDENT_CITY == \"CHICAGO\") |> \n    # Transform to \"NAD83/Illinois East\" projection\n    st_transform(26971)\n\nwarming_centers <-\n    # Parse csv file\n    read_csv(here::here(\"data\", \"Warming_Centers_-_Map.csv\")) |> \n    # Extract coordinates data nested within the \"LOCATION\" variable\n    separate(\n        LOCATION, \n        sep = \"\\n\", \n        into = c(\"street\", \"city_state_zip\", \"coords\")\n    ) |> \n    # Remove parentheses from coordinates data\n    mutate(coords = str_remove_all(coords, \"[\\\\(\\\\)]\")) |> \n    # Separate longitude and latitude into distinct variables\n    separate(\n        coords,\n        sep = \",\",\n        into = c(\"lat\", \"long\")\n    ) |> \n    # Convert longitude and latitude from characters to numeric variables\n    mutate(\n        lat = as.numeric(lat),\n        long = as.numeric(long)\n    ) |> \n    # Convert dataframe into simple features collection\n    st_as_sf(coords = c(\"long\", \"lat\")) |> \n    # Set CRS as WGS84\n    st_set_crs(4326) |> \n    # Transform CRS to NAD83/Illinois East projection\n    st_transform(26971)\n```\n:::\n\n\nNext, in order to visualize areas of high risk, I have created the following user-defined function to generate kernel density estimation (KDE) rasters using a smoothing bandwidth of 1 km:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrangle_point_density <- function(points_sf, border_sf) {\n    \n    # Convert simple feature points to \"planar point pattern\" data class\n    ppp1 <- as.ppp(points_sf)\n   \n     # Set Chicago border as the window for the point pattern\n    Window(ppp1) <- as.owin(border_sf)\n    \n    kde1 <- \n        # Perform kernel density estimation\n        density(ppp1, 1000) |> \n        # Convert to raster data class\n        rast()\n    \n    # Reset projection\n    crs(kde1) <- \"epsg:26971\"\n    \n    return(kde1)\n    \n}\n```\n:::\n\n\nNext, perform KDE on cold deaths and warming centers respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncold_deaths_kde <- \n    # Generate kernel density estimation for cold deaths\n    wrangle_point_density(cold_deaths, chicago_border) |>\n    # Rename kde variable\n    rename(cold_death_density = lyr.1) |>\n    # Tranform kde variable to percentile rank\n    mutate(cold_death_rank = percent_rank(cold_death_density) * 100)\n\nwarming_centers_kde <- \n    # Generate kernel density estimation for warming centers\n    wrangle_point_density(warming_centers, chicago_border) |>\n    # Rename kde variable\n    rename(warming_center_density = lyr.1) |>\n    # Tranform kde variable to (reverse) percentile rank\n    mutate(warming_center_rank = percent_rank(desc(warming_center_density)) * 100)\n```\n:::\n\n\nHere is a quick and dirty comparison plot between the raw density calculation and its conversion into percentile ranks for cold deaths.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(cold_deaths_kde)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nNext, here is a [prettier visualization](https://danielriggins.com/widgets/chicago_cold_deaths_map.html) of just the percentile ranks for cold-death density with the cold death cases overlaid on top:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set to static maps mode in the tmap package\ntmap_mode(\"view\")\n\n# Map Chicago border\ntm_shape(chicago_border) +\n    tm_borders() +\n    # Add cold death density raster with blue color scheme and opacity of 0.7\n    tm_shape(cold_deaths_kde$cold_death_rank) +\n    tm_raster(\n        palette = \"Blues\", \n        title = \"Percentile Rank\",\n        alpha = 0.7\n    ) +\n    # Add cold death points with pop-up information\n    tm_shape(cold_deaths) +\n    tm_dots(\n        # Choose variables displayed in pop-up bubble\n        popup.vars = c(\"INCIDENT_DATE\", \"MANNER\", \"PRIMARYCAUSE\", \"AGE\", \"GENDER\", \"RACE\", \"LATINO\")\n    ) +\n    # Add a title\n    tm_layout(\n        title = \"Density of Cold-Related CCME Cases, <br> Cook County, IL, 2014-2022\"\n    )\n```\n:::\n\n```{=html}\n<iframe width=\"780\" height=\"500\" src=\"http://danielriggins.com/widgets/chicago_cold_deaths_map.html\" title=\"Chicago Cold Deaths\"></iframe>\n```\n\n\nNext, is the [equivalent map for warming centers](https://danielriggins.com/widgets/chicago_warming_centers_map.html), but note I have reversed the percentile ranks such that areas of lowest density have highest rank. This is so higher numbers translate to higher risk both for cold deaths and warming centers. To make this more intuitive, I have set the color scheme in this map such that blue regions correspond to \"cold\" places with lower density of warming centers, and yellow regions correspond to \"warm\" regions with higher density of warming centers. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map Chicago border\ntm_shape(chicago_border) +\n    tm_borders() +\n    # Add warming center density raster with plasma color scheme and opacity of 0.7\n    tm_shape(warming_centers_kde$warming_center_rank) +\n    tm_raster(\n        palette = \"-plasma\", \n        title = \"Reverse Percentile Rank\",\n        alpha = 0.7\n    ) +\n    # Add warming center points with pop-ups\n    tm_shape(warming_centers) +\n    tm_dots(\n        col = \"black\",\n        popup.vars = c(\"SITE NAME\", \"SITE TYPE\", \"HOURS OF OPERATION\", \"ADDRESS\", \"CITY\", \"STATE\", \"ZIP\", \"PHONE\")\n    ) +\n    # Add a title\n    tm_layout(\n        title = \"Reverse Density of Warming Centers, <br> Cook County, IL, 2017\"\n    ) \n```\n:::\n\n```{=html}\n<iframe width=\"780\" height=\"500\" src=\"http://danielriggins.com/widgets/chicago_warming_centers_map.html\" title=\"Chicago Warming Centers\"></iframe>\n```\n\n\nNext, lets multiply the two rankings together such that high values of the product correspond to problem areas where there are relatively high amounts of cold-related deaths and low proximity to warming centers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomposite_risk <-\n    # Combine rasters for warming center and cold death percentile ranks\n    c(warming_centers_kde$warming_center_rank, cold_deaths_kde$cold_death_rank) |>\n    # Create composite variable\n    mutate(composite_risk = warming_center_rank * cold_death_rank / 100) |> \n    # Drop all other variables\n    select(composite_risk)\n```\n:::\n\n\nAnd finally, let's [map the composite risk](https://danielriggins.com/widgets/chicago_cold_risk_map.html) (darker colors are \"cold\"/higher risk) with cold deaths (blue) and warming centers (red) overlaid on top.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map composite risk raster with magma color scheme and opacity of 0.7\ntm_shape(composite_risk) +\n    tm_raster(\n        palette = \"-magma\", \n        alpha = 0.7,\n        title = \"Composite Percentile Rank\"\n    ) +\n    # Add Chicago Community Areas with hovertext labels and transparent fills\n    tm_shape(chicago_comm_areas) +\n    tm_polygons(alpha = 0) +\n    # Add cold death points colored blue with pop-up text\n    tm_shape(cold_deaths) +\n    tm_dots(\n        col = \"blue\",\n        popup.vars = c(\"INCIDENT_DATE\", \"MANNER\", \"PRIMARYCAUSE\", \"AGE\", \"GENDER\", \"RACE\", \"LATINO\")\n    ) +\n    # Add warming center points colored red with pop-up text\n    tm_shape(warming_centers) +\n    tm_dots(\n        col = \"red\",\n        popup.vars = c(\"SITE NAME\", \"SITE TYPE\", \"HOURS OF OPERATION\", \"ADDRESS\", \"CITY\", \"STATE\", \"ZIP\", \"PHONE\")\n    ) +\n    # Add a title\n    tm_layout(\n        title = \"Combined Risk from High Density of Cold Deaths (blue) <br> and Low Density of Warming Centers (red)\"\n    ) \n```\n:::\n\n```{=html}\n<iframe width=\"780\" height=\"500\" src=\"http://danielriggins.com/widgets/chicago_cold_risk_map.html\" title=\"Chicago Cold Risk\"></iframe>\n```\n\n\n# Discussion\n\nThis exploratory analysis identified areas of the city at risk of cold deaths based on density calculations of where deaths had taken place previously and where warming centers were present to mitigate. \n\nKernel density estimation can be somewhat less reliable when used at the edges of a sampling window, so I put less weight into these areas. \nThe highest risk areas not on edges of the Chicago border included the neighborhoods of Belmont-Cragin/Hermosa, Humboldt Park, the Lower West Side, New City, Chicago Lawn, (West) Englewood, Greater Grand Crossing, Chatham, Roseland, and West Pullman. \nThese neighborhoods tended to be in the West or South regions of the city as a whole.\n\n## Limitations\n\nThere are limitations to this preliminary analysis. \nFirst, proximity to a warming center has not been causally established to mitigate risk of cold deaths. \nOne would need to perform a regression analysis while controlling for confounding/colliding variables to determine whether such a mitigating relationship indeed existed. \nFurthermore, it is possible that physical proximity to a warming center in Euclidean space may be less informative of a measure than \"travel time\" to a warming center by some means of accessible transportation like public bus or train. \nAlthough there are [services available](https://traveltime.com/) to calculate travel time, these services cost money, especially when trying to calculate isochronic surfaces across the whole city to multiple points.\n\n# Conclusions\n\nA high degree of cold-related morbidity and mortality persisted in the city of Chicago despite the presence of a large number of publicly-available warming centers. \nIf trying to expand the presence of warming centers, planners should consider prioritizing the neighborhoods listed above on the South and West Sides. \nPublic Health practitioners should also consider alternative interventions like increasing education about preexisting centers and expanding access to permanent housing for those experiencing homelessness.\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}